"use strict";angular.module("todoAnimations",["ngAnimate"]);var planningApp=angular.module("planningApp",["ngRoute","pageControllers","ui.bootstrap","colorpicker.module"]);planningApp.config(["$routeProvider",function(e){e.when("/todo",{templateUrl:"parts/todo.html",controller:"ToDoCtrl"}).when("/todos/:param",{templateUrl:"parts/todo-details.html",controller:"ToDoDetailCtrl"}).when("/people",{templateUrl:"parts/people.html",controller:"PeopleCtrl"}).when("/person/:param",{templateUrl:"parts/person-details.html",controller:"PersonDetailCtrl"}).when("/todo_categories",{templateUrl:"parts/todo-categories.html",controller:"TodoCategoriesCtrl"}).when("/todo-category/:param",{templateUrl:"parts/todo-category-detail.html",controller:"TodoCategoryDetailCtrl"}).when("/tobuy",{templateUrl:"parts/tobuy.html",controller:"ToBuyCtrl"}).when("/tobuys/:param",{templateUrl:"parts/tobuy-details.html",controller:"ToBuyDetailCtrl"}).when("/tobuy_categories",{templateUrl:"parts/tobuy-categories.html",controller:"TobuyCategoriesCtrl"}).when("/tobuy-category/:param",{templateUrl:"parts/tobuy-category-detail.html",controller:"TobuyCategoryDetailCtrl"}).otherwise({redirectTo:"/todo"})}]),planningApp.run(["$rootScope","$location","FormStateService",function(e,t,o){e.$on("$locationChangeStart",function(e,t,n){o.isDirty&&o.saveFunction(o.objectToSave)})}]),angular.module("colorpicker.module",[]).factory("helper",function(){return{closest:function(e,t){for(var o=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;e;){if(o.bind(e)(t))return e;e=e.parentNode}return!1},getOffset:function(e){for(var t=0,o=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t+=e.offsetLeft,o+=e.offsetTop,e=e.offsetParent;return{top:o,left:t}},extend:function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}]}}).factory("Color",["helper",function(e){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var e=this.toRGB();return"rgb("+e.r+","+e.g+","+e.b+")"},rgba:function(){var e=this.toRGB();return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(e,t,o,n){e/=255,t/=255,o/=255;var r,i,a,s;return a=Math.max(e,t,o),s=a-Math.min(e,t,o),r=0===s?null:a==e?(t-o)/s:a==t?(o-e)/s+2:(e-t)/s+4,r=(r+360)%6*60/360,i=0===s?0:s/a,{h:r||1,s:i,b:a,a:n||1}},HueToRGB:function(e,t,o){return 0>o?o+=1:o>1&&(o-=1),1>6*o?e+(t-e)*o*6:1>2*o?t:2>3*o?e+(t-e)*(2/3-o)*6:e},setColor:function(t){t=t.toLowerCase();for(var o in e.stringParsers){var n=e.stringParsers[o],r=n.re.exec(t),i=r&&n.parse(r);n.space||"rgba";if(i)return this.value=this.RGBtoHSB.apply(null,i),!1}},setHue:function(e){this.value.h=1-e},setSaturation:function(e){this.value.s=e},setLightness:function(e){this.value.b=1-e},setAlpha:function(e){this.value.a=parseInt(100*(1-e),10)/100},toRGB:function(e,t,o,n){e||(e=this.value.h,t=this.value.s,o=this.value.b),e*=360;var r,i,a,s,d;return e=e%360/60,d=o*t,s=d*(1-Math.abs(e%2-1)),r=i=a=o-d,e=~~e,r+=[d,s,0,0,s,d][e],i+=[s,d,d,s,0,0][e],a+=[0,0,s,d,d,s][e],{r:Math.round(255*r),g:Math.round(255*i),b:Math.round(255*a),a:n||this.value.a}},toHex:function(e,t,o,n){var r=this.toRGB(e,t,o,n);return"#"+(1<<24|parseInt(r.r)<<16|parseInt(r.g)<<8|parseInt(r.b)).toString(16).substr(1)}}}]).directive("colorpicker",["$document","$compile","Color","helper",function(e,t,o,n){return{require:"?ngModel",restrict:"A",link:function(r,i,a,s){var d,c,u,l,p='<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div></div></div><button class="close close-colorpicker">&times;</button></div>',f=angular.element(p),g=o,b=null,y=null,T=a.colorpicker?a.colorpicker:"hex",h=a.colorpickerPosition?a.colorpickerPosition:"bottom";t(f)(r),c={enabled:"rgba"===T,css:null},c.enabled===!0&&(f.addClass("alpha"),c.css=f.find("div")[2].style),f.addClass("colorpicker-position-"+h),angular.element(document.body).append(f),s&&(s.$render=function(){i.val(s.$viewValue)},r.$watch(a.ngModel,function(){k()})),i.bind("$destroy",function(){f.remove()}),u=f.find("div")[0].style,d=f.find("div")[4].style,l=f.find("i");var v=function(){try{d.backgroundColor=g[T]()}catch(e){d.backgroundColor=g.toHex()}u.backgroundColor=g.toHex(g.value.h,1,1,1),c.enabled===!0&&(c.css.backgroundColor=g.toHex())},w=function(e){e.stopPropagation(),e.preventDefault();var t=n.closest(e.target,"div");if("colorpicker-saturation"===t.className)y=n.extend({},{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"});else if("colorpicker-hue"===t.className)y=n.extend({},{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"});else{if("colorpicker-alpha"!==t.className)return y=null,!1;y=n.extend({},{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"})}y.knob=t.children[0].style,y.left=e.pageX-n.getOffset(t).left,y.top=e.pageY-n.getOffset(t).top,b={left:e.pageX,top:e.pageY}},C=function(e){if(y){var t=Math.max(0,Math.min(y.maxLeft,y.left+((e.pageX||b.left)-b.left))),o=Math.max(0,Math.min(y.maxTop,y.top+((e.pageY||b.top)-b.top)));y.knob.left=t+"px",y.knob.top=o+"px",y.callLeft&&g[y.callLeft].call(g,t/100),y.callTop&&g[y.callTop].call(g,o/100),v();var n=g[T]();return i.val(n),s&&r.$apply(s.$setViewValue(n)),!1}},m=function(){e.unbind("mousemove",C),e.unbind("mouseup",m)},k=function(){g.setColor(i.val()),l.eq(0).css({left:100*g.value.s+"px",top:100-100*g.value.b+"px"}),l.eq(1).css("top",100*(1-g.value.h)+"px"),l.eq(2).css("top",100*(1-g.value.a)+"px"),v()},L=function(){var e,t=n.getOffset(i[0]);return"top"===h?e={top:t.top-146,left:t.left}:"right"===h?e={top:t.top,left:t.left+141}:"bottom"===h?e={top:t.top+i[0].offsetHeight,left:t.left}:"left"===h&&(e={top:t.top,left:t.left-131}),{top:e.top+"px",left:e.left+"px"}};i.bind("click",function(){k(),f.addClass("colorpicker-visible").css(L())}),f.bind("mousedown",function(e){e.stopPropagation(),e.preventDefault()}),f.find("div").bind("click",function(e){w(e),C(e)}),f.find("div").bind("mousedown",function(t){w(t),e.bind("mousemove",C),e.bind("mouseup",m)});var S=function(){f.hasClass("colorpicker-visible")&&f.removeClass("colorpicker-visible")};f.find("button").bind("click",function(){S()}),e.bind("mousedown",function(){S()})}}}]);var pageControllers=angular.module("pageControllers",[]),ToDoCtrl=pageControllers.controller("ToDoCtrl",["$scope","$rootScope","$http","ListService","DbService","DateService",function(e,t,o,n,r,i){void 0==t.todoList&&r.getAllTodos(e,t),void 0==t.todoCategoryList&&r.getAllTodoCategories(e,t),void 0==t.peopleList&&r.getAllPeople(e,t),void 0==t.tobuyList&&r.getAllTobuys(e,t),void 0==t.tobuyCategoryList&&r.getAllTobuyCategories(e,t),t.newTodoCount=void 0==t.newTodoCount?1:t.newTodoCount,e.orderProp="name",e.reverse=!1,e.removeToDo=function(o){r.deleteTodoRecord(o),n["delete"](o,e.todoList);var i,a=e.tobuyList.length;for(i=a-1;i>=0;i--)t.tobuyList[i].usedIn==o&&t.tobuyList.splice(i,1)},e.showDays=function(e){return e>0},e.addToDo=function(){e.todoList.push({name:"New TODO "+t.newTodoCount,status:"inprogress",creationDate:new Date}),e.orderProp="creationDate",r.createTodoRecord("New TODO "+t.newTodoCount,e.todoList),t.newTodoCount++},e.getTodoCatColor=function(e){return n.getColor(e,t.todoCategoryList)},e.getTodoStatus=function(e){return e.daysToGo=0,""!=e.deadline&&void 0!=e.deadline&&e.deadline.length<21&&"done"!=e.status&&(e.daysToGo=i.checkDaysToGo(e.deadline),e.daysToGo<0&&(e.status="expired")),e.status},e.setListDirection=function(t){e.reverse=t}}]),ToDoDetailCtrl=pageControllers.controller("ToDoDetailCtrl",["$scope","$rootScope","$http","$routeParams","ListService","DbService","FeedbackService","FormStateService","$location",function(e,t,o,n,r,i,a,s,d){e.curIndex=r.getIndex(n.param,t.todoList),void 0!=e.curIndex?e.curTodo=t.todoList[e.curIndex]:d.path("/todo"),e.curTodo&&!e.curTodo.deadlineChecked&&""!=e.curTodo.deadline&&e.curTodo.daysToGo<0&&(alert("This TODO has expired!"),e.curTodo.deadlineChecked=!0),e.todoTab="general",e.changeTab=function(t){s.isDirty&&s.saveFunction(s.objectToSave),e.todoTab=t},$(".nav li a").on("click",function(){$(this).parent().parent().find(".active").removeClass("active"),$(this).parent().addClass("active").css("color","yellow")}),e.$watch("todoForm.$dirty",function(t){s.isDirty=t,s.objectToSave=e.curTodo,s.saveFunction=e.update}),e.update=function(t){var o=$("#deadlineField").val();e.curTodo.deadline=o,i.updateTodo({id:t.id,name:t.name,description:t.description,criterion:t.criterion,creationDate:t.creationDate,deadline:o,status:t.status,category:t.category},a.giveFeedback),$("#todo-feedback").text("saving..."),s.isDirty=!1},e.minDate=new Date,e.dateOptions={formatYear:"yy",startingDay:1},e.openDatePicker=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0},e.curTodo&&void 0==e.curTodo.people&&(e.curTodo.people=[],i.getPeopleForTodo(e.curTodo.id,t.peopleList,e)),e.peopleList=angular.copy(t.peopleList),e.addToPeople=function(){var t=JSON.parse(e.selectedPerson);e.curTodo.people.push(t),i.addPersonToTodo(t.id,e.curTodo.id),r["delete"](t.name,e.peopleList)},e.removeFromPeople=function(t){i.removePersonFromTodo(t.id,e.curTodo.id),r["delete"](t.id,e.curTodo.people),e.peopleList.push(t)},e.curTodo&&void 0==e.curTodo.tobuyList&&(e.curTodo.tobuyList=angular.bind(t.tobuyList)),t.newItemCount=void 0==t.newItemCount?1:t.newItemCount,e.addToShoppingList=function(){t.tobuyList.push({name:"New TOBUY "+t.newItemCount,status:"inprogress",usedIn:e.curTodo.id,creationDate:new Date,price:0,quantity:1}),i.createTobuyRecord("New TOBUY "+t.newItemCount,e.curTodo.id,t.tobuyList),t.newItemCount++},e.removeFromShoppingList=function(e){i.deleteTobuyRecord(e.id),r["delete"](e.id,t.tobuyList)},e.getItemCatColor=function(e){return r.getColor(e,t.tobuyCategoryList)},t.newSubTaskCount=void 0==t.newSubTaskCount?1:t.newSubTaskCount,e.curTodo&&void 0==e.curTodo.subTasks&&(e.curTodo.subTasks=[],i.getSubTasks(e.curTodo.id,e)),e.addToSubTasks=function(){i.createSubTaskRecord("New Subtask"+t.newSubTaskCount,e.curTodo.id,e.curTodo.subTasks),e.curTodo.subTasks.push({name:"New Subtask"+t.newSubTaskCount,status:"inprogress",parentTaskId:e.curTodo.id}),e.newSubTaskCount++},e.removeFromSubtasks=function(t){i.deleteSubTaskRecord(t.id),r["delete"](t.id,e.curTodo.subTasks)},e.editSubTask=function(t){e.todoTab="editSubTask",e.curSubTaskIndex=r.getIndex(t.id,e.curTodo.subTasks),e.curSubTask=e.curTodo.subTasks[e.curSubTaskIndex]},e.$watch("subTaskForm.$dirty",function(t){s.isDirty=t,s.objectToSave=e.curSubTask,s.saveFunction=e.updateSubTask}),e.updateSubTask=function(t){var o=$("#subtask-deadlineField").val();e.curSubTask.deadline=t.deadline=o,i.updateSubTask(t,a.giveFeedback)},void 0==e.relatedTodoList&&(t.relatedTodoList=angular.copy(t.todoList)),e.curTodo&&void 0==e.curTodo.related&&(e.curTodo.related=[],i.getRelatedTodos(e.curTodo.id,e,t.relatedTodoList)),e.addToRelated=function(){var o=JSON.parse(e.selectedRelated);e.curTodo.related.push(o),r["delete"](o.id,t.relatedTodoList),i.createRelatedTodo(e.curTodo.id,o.id)},e.removeFromRelated=function(o){i.removeRelatedTodo(e.curTodo.id,o.id),r["delete"](o.id,e.curTodo.related),t.relatedTodoList.push(o)},e.getTodoCatColor=function(e){return r.getColor(e,t.todoCategoryList)}}]),PeopleCtrl=pageControllers.controller("PeopleCtrl",["$scope","$rootScope","$http","ListService","DbService",function(e,t,o,n,r){void 0==t.peopleList&&r.getAllPeople(e,t),t.newPersonCount=void 0==t.newPersonCount?1:t.newPersonCount,e.orderProp="name",e.reverse=!1,e.removePerson=function(t){n["delete"](t,e.peopleList),r.deletePersonRecord(t)},e.addPerson=function(){e.peopleList.push({name:"New Person "+e.newPersonCount}),e.orderProp="creationDate",r.createPersonRecord("New Person "+e.newPersonCount,e.peopleList),e.newPersonCount++},e.setListDirection=function(t){e.reverse=t}}]),PersonDetailCtrl=pageControllers.controller("PersonDetailCtrl",["$scope","$rootScope","$routeParams","ListService","DbService","FeedbackService","FormStateService","$location",function(e,t,o,n,r,i,a,s){e.curIndex=n.getIndex(o.param,t.peopleList),void 0!=e.curIndex?e.curPerson=t.peopleList[e.curIndex]:s.path("/people"),e.$watch("personForm.$dirty",function(t){a.isDirty=t,a.objectToSave=e.curPerson,a.saveFunction=e.update}),e.update=function(e){r.updatePerson({id:e.id,name:e.name,"function":e["function"],phone:e.phone,email:e.email},i.giveFeedback),a.isDirty=!1}}]),TodoCategoriesCtrl=pageControllers.controller("TodoCategoriesCtrl",["$scope","$rootScope","$http","ListService","DbService",function(e,t,o,n,r){void 0==t.todoCategoryList&&r.getAllTodoCategories(e,t),e.todoCategoryList=t.todoCategoryList,t.newCategoryCount=void 0==t.newCategoryCount?1:t.newCategoryCount,e.orderProp="name",e.removeCategory=function(t){n["delete"](t,e.todoCategoryList),r.deleteTodoCatRecord(t)},e.addCategory=function(){e.todoCategoryList.push({name:"New Category "+t.newCategoryCount}),r.createTodoCatRecord("New Category "+t.newCategoryCount,e.todoCategoryList),t.newCategoryCount++}}]),TodoCategoryDetailCtrl=pageControllers.controller("TodoCategoryDetailCtrl",["$scope","$rootScope","$routeParams","ListService","DbService","FeedbackService","FormStateService","$location",function(e,t,o,n,r,i,a,s){e.curIndex=n.getIndex(o.param,t.todoCategoryList),void 0!=e.curIndex?e.curCategory=t.todoCategoryList[e.curIndex]:s.path("/todo_categories"),e.$watch("tobuyCategoryForm.$dirty",function(t){a.isDirty=t,a.objectToSave=e.curCategory,a.saveFunction=e.update}),e.update=function(e){r.updateTodoCat({id:e.id,name:e.name,color:e.color},i.giveFeedback),a.isDirty=!1}}]),ToBuyCtrl=pageControllers.controller("ToBuyCtrl",["$scope","$rootScope","$http","ListService","DbService","DateService",function(e,t,o,n,r,i){void 0==t.tobuyList&&r.getAllTobuys(e,t),void 0==t.tobuyCategoryList&&r.getAllTobuyCategories(e,t),e.newTobuyCount=1,t.newTobuyCount=void 0==t.newTobuyCount?1:t.newTobuyCount,e.orderProp="name",e.reverse=!1,e.removeToBuy=function(t){r.deleteTobuyRecord(t),n["delete"](t,e.tobuyList)},e.addToBuy=function(){e.tobuyList.push({name:"New TOBUY "+t.newTobuyCount,status:"inprogress",creationDate:new Date,quantity:1}),r.createTobuyRecord("New TOBUY "+t.newTobuyCount,"",e.tobuyList),t.newTobuyCount++,e.orderProp="creationDate"},e.showDays=function(e){return e>0},e.getItemCatColor=function(e){return n.getColor(e,t.tobuyCategoryList)},e.getTobuyStatus=function(e){return e.daysToGo=0,""!=e.deadLine&&void 0!=e.deadLine&&e.deadLine.length<21&&"done"!=e.status&&(e.daysToGo=i.checkDaysToGo(e.deadLine),e.daysToGo<0&&(e.status="expired")),e.status},e.setListDirection=function(t){e.reverse=t},e.countTotalAmount=function(){e.totalAmount=0;for(var t=e.tobuyList.length,o=0;t>o;o++){var n=e.tobuyList[o],r=n.price*n.quantity;e.totalAmount+=r}}}]),ToBuyDetailCtrl=pageControllers.controller("ToBuyDetailCtrl",["$scope","$rootScope","$http","$routeParams","ListService","DbService","FeedbackService","FormStateService","$location",function(e,t,o,n,r,i,a,s,d){void 0==t.todoList&&i.getAllTodos(e,t),e.curIndex=r.getIndex(n.param,t.tobuyList),void 0!=e.curIndex?e.curTobuy=t.tobuyList[e.curIndex]:d.path("/tobuy"),e.curTobuy&&!e.curTobuy.deadlineChecked&&""!=e.curTobuy.deadLine&&e.curTobuy.daysToGo<0&&(alert("This TOBUY has expired!"),e.curTobuy.deadlineChecked=!0),e.minDate=new Date,e.openDatePicker=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0},e.dateOptions={formatYear:"yy",startingDay:1},e.openDatePicker=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0},e.$watch("tobuyForm.$dirty",function(t){s.isDirty=t,s.objectToSave=e.curTobuy,s.saveFunction=e.update}),e.update=function(t){var o=$("#deadlineField").val();e.curTobuy.deadline=o,i.updateTobuy({id:t.id,name:t.name,price:t.price,quantity:t.quantity,creationDate:t.creationDate,deadline:o,status:t.status,category:t.category,supplier:t.supplier,usedIn:t.usedIn},a.giveFeedback),s.isDirty=!1},e.getName=function(e){return r.getPropertyById(e,"name",t.todoList)}}]),TobuyCategoriesCtrl=pageControllers.controller("TobuyCategoriesCtrl",["$scope","$rootScope","$http","ListService","FeedbackService","DbService",function(e,t,o,n,r,i){void 0==t.tobuyCategoryList&&i.getAllTobuyCategories(e,t),e.tobuyCategoryList=t.tobuyCategoryList,e.newCategoryCount=1,t.newCategoryCount=void 0==t.newCategoryCount?1:t.newCategoryCount,e.orderProp="name",e.removeCategory=function(t){n["delete"](t,e.tobuyCategoryList),i.deleteTobuyCatRecord(t)},e.addCategory=function(){e.tobuyCategoryList.push({name:"New Category "+t.newCategoryCount}),e.orderProp="creationDate",i.createTobuyCatRecord("New Category "+t.newCategoryCount,e.tobuyCategoryList),t.newCategoryCount++}}]),TobuyCategoryDetailCtrl=pageControllers.controller("TobuyCategoryDetailCtrl",["$scope","$rootScope","$routeParams","ListService","DbService","FeedbackService","FormStateService","$location",function(e,t,o,n,r,i,a,s){e.curIndex=n.getIndex(o.param,t.tobuyCategoryList),void 0!=e.curIndex?e.curCategory=t.tobuyCategoryList[e.curIndex]:s.path("/tobuy_categories"),e.$watch("tobuyCategoryForm.$dirty",function(t){a.isDirty=t,a.objectToSave=e.curCategory,a.saveFunction=e.update}),e.update=function(e){r.updateTobuyCat({id:e.id,name:e.name,color:e.color},i.giveFeedback)}}]);planningApp.service("DateService",function(){this.checkDaysToGo=function(e){var t=e.substring(0,4),o=e.substring(5,7),n=e.substring(8,10),r=new Date(t,o-1,n),i=new Date,a=864e5;return Math.round((r.getTime()-i.getTime())/a)}});var DbService=planningApp.service("DbService",["$http","ListService","$rootScope",function(e,t,o){this.getAllTodos=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/todo.php",{action:"getAll"}).success(function(e){"0 results"==e?t.todoList=o.todoList=[]:t.todoList=o.todoList=e})},this.createTodoRecord=function(o,n){e.post("http://www.leeuwdesign.nl/todo/backend/todo.php",{action:"createRecord",name:o,status:"inprogress",creationDate:new Date}).success(function(e){t.setId(o,e,n)})},this.deleteTodoRecord=function(t){e.post("http://www.leeuwdesign.nl/todo/backend/todo.php",{action:"deleteRecord",id:t}).success(function(e){})},this.updateTodo=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/todo.php",{action:"update",id:t.id,name:t.name,description:t.description,criterion:t.criterion,deadline:t.deadline,creationDate:t.creationDate,status:t.status,category:t.category}).success(function(e){o("Your todo is saved.")})},this.getSubTasks=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/subtasks.php",{action:"getAll",id:t}).success(function(e){"0 results"==e?o.curTodo.subTasks=[]:o.curTodo.subTasks=e})},this.createSubTaskRecord=function(o,n,r){e.post("http://www.leeuwdesign.nl/todo/backend/subtasks.php",{action:"createRecord",name:o,status:"inprogress",parentTaskId:n}).success(function(e){t.setId(o,e,r)})},this.deleteSubTaskRecord=function(t){e.post("http://www.leeuwdesign.nl/todo/backend/subtasks.php",{action:"deleteRecord",id:t}).success(function(e){})},this.updateSubTask=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/subtasks.php",{action:"update",id:t.id,name:t.name,description:t.description,criterion:t.criterion,deadline:t.deadline,status:t.status}).success(function(e){o("Your subtask is saved.")})},this.createRelatedTodo=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/related_todos.php",{action:"createRecord",todo1_id:t,todo2_id:o}).success(function(e){})},this.getRelatedTodos=function(n,r,i){e.post("http://www.leeuwdesign.nl/todo/backend/related_todos.php",{action:"getAll",id:n}).success(function(e){if("0 results"!=e){var a,s=e;for(a in s){var d;for(d in i)(s[a].todo2_id==i[d].id&&i[d].id!=n||s[a].todo1_id==i[d].id&&i[d].id!=n)&&(r.curTodo.related.push(i[d]),t["delete"](i[d].id,o.relatedTodoList))}}})},this.removeRelatedTodo=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/related_todos.php",{action:"deleteRecord",todo1_id:t,todo2_id:o}).success(function(e){})},this.getAllTodoCategories=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/todocat.php",{action:"getAll"}).success(function(e){"0 results"==e?t.todoCategoryList=o.todoCategoryList=[]:t.todoCategoryList=o.todoCategoryList=e})},this.createTodoCatRecord=function(o,n){e.post("http://www.leeuwdesign.nl/todo/backend/todocat.php",{action:"createRecord",name:o}).success(function(e){t.setId(o,e,n)})},this.deleteTodoCatRecord=function(t){e.post("http://www.leeuwdesign.nl/todo/backend/todocat.php",{action:"deleteRecord",id:t}).success(function(e){})},this.updateTodoCat=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/todocat.php",{action:"update",id:t.id,name:t.name,color:t.color}).success(function(e){o("Your category is saved.")})},this.getAllTobuyCategories=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/tobuycat.php",{action:"getAll"}).success(function(e){"0 results"==e?t.tobuyCategoryList=o.tobuyCategoryList=[]:t.tobuyCategoryList=o.tobuyCategoryList=e})},this.createTobuyCatRecord=function(o,n){e.post("http://www.leeuwdesign.nl/todo/backend/tobuycat.php",{action:"createRecord",name:o}).success(function(e){t.setId(o,e,n)})},this.deleteTobuyCatRecord=function(t){e.post("http://www.leeuwdesign.nl/todo/backend/tobuycat.php",{action:"deleteRecord",id:t}).success(function(e){})},this.updateTobuyCat=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/tobuycat.php",{action:"update",id:t.id,name:t.name,color:t.color}).success(function(e){o("Your category is saved.")})},this.getAllPeople=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/people.php",{action:"getAll"}).success(function(e){"0 results"==e?t.peopleList=o.peopleList=[]:t.peopleList=o.peopleList=e})},this.createPersonRecord=function(o,n){e.post("http://www.leeuwdesign.nl/todo/backend/people.php",{action:"createRecord",name:o}).success(function(e){t.setId(o,e,n)})},this.deletePersonRecord=function(t){e.post("http://www.leeuwdesign.nl/todo/backend/people.php",{action:"deleteRecord",id:t}).success(function(e){})},this.updatePerson=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/people.php",{action:"update",id:t.id,name:t.name,"function":t["function"],phone:t.phone,email:t.email}).success(function(e){o("Your person is saved.")})},this.addPersonToTodo=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/people.php",{action:"addPersonToTodo",todo_id:o,person_id:t}).success(function(e){})},this.removePersonFromTodo=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/people.php",{action:"removePersonFromTodo",todo_id:o,person_id:t}).success(function(e){})},this.getPeopleForTodo=function(t,o,n){e.post("http://www.leeuwdesign.nl/todo/backend/people.php",{action:"getPeopleForTodo",todo_id:t}).success(function(e){if("0 results"!=e){var t,r=e;for(t in r){var i;for(i in o)r[t].person_id==o[i].id&&-1==n.curTodo.people.indexOf(o[i])&&(o[i].usedInId=n.curTodo.people.push(o[i]))}}})},this.getAllTobuys=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/tobuy.php",{action:"getAll"}).success(function(e){"0 results"==e?t.tobuyList=o.tobuyList=[]:t.tobuyList=o.tobuyList=e})},this.createTobuyRecord=function(o,n,r){e.post("http://www.leeuwdesign.nl/todo/backend/tobuy.php",{action:"createRecord",name:o,usedIn:n,status:"inprogress",creationDate:new Date}).success(function(e){t.setId(o,e,r)})},this.deleteTobuyRecord=function(t){e.post("http://www.leeuwdesign.nl/todo/backend/tobuy.php",{action:"deleteRecord",id:t}).success(function(e){})},this.updateTobuy=function(t,o){e.post("http://www.leeuwdesign.nl/todo/backend/tobuy.php",{action:"update",id:t.id,name:t.name,price:t.price,quantity:t.quantity,deadline:t.deadline,creationDate:t.creationDate,status:t.status,category:t.category,usedIn:t.usedIn,supplier:t.supplier}).success(function(e){o("Your tobuy is saved.")})}}]);planningApp.directive("integer",function(){var e=/^\-?\d+$/;return{require:"ngModel",link:function(t,o,n,r){r.$validators.integer=function(t,o){return r.$isEmpty(t)?!0:!!e.test(o)}}}}),planningApp.service("FeedbackService",function(){this.giveFeedback=function(e){$(".feedback-text").text(e),setTimeout(function(){$(".feedback-text").text("")},3e3)}}),planningApp.service("FormStateService",function(){var e=this;this.showSaveDialog=function(t){var o=$("<p>Do you want to save your changes?</p>").dialog({buttons:{Yes:function(){e.saveFunction(e.objectToSave),location.href=t,o.dialog("close")},No:function(){e.isDirty=!1,location.href=t,o.dialog("close")},Cancel:function(){o.dialog("close")}}})}}),planningApp.service("ListService",function(){this["delete"]=function(e,t){var o;for(o in t)t[o].id==e&&t.splice(o,1)},this.getIndex=function(e,t){var o;for(o in t)if(t[o].id==e)return o},this.getPropertyById=function(e,t,o){var n;for(n in o)if(o[n].id==e)return o[n][t]},this.getColor=function(e,t){var o;for(o in t)if(t[o].name==e)return t[o].color},this.setId=function(e,t,o){var n;for(n in o)if(o[n].name==e){o[n].id=t;break}},this.getId=function(e,t){var o;for(o in t)if(t[o].name==e)return t[o].id}});